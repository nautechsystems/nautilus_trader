name: common-test-data
description: Common test data caching

runs:
  using: "composite"
  steps:
    - name: Restore test data from cache
      id: cached-testdata-large
      # https://github.com/actions/cache/tree/main/restore
      uses: actions/cache/restore@0400d5f644dc74513175e3cd8d07132dd4860809 # v4.2.4
      with:
        path: tests/test_data/large
        key: large-files-${{ hashFiles('tests/test_data/large/checksums.json') }}
        restore-keys: large-files-
        enableCrossOsArchive: true

    - name: Save test data to cache
      if: ${{ always() && steps.cached-testdata-large.outputs.cache-hit != 'true' }}
      # https://github.com/actions/cache/tree/main/save
      uses: actions/cache/save@0400d5f644dc74513175e3cd8d07132dd4860809 # v4.2.4
      with:
        path: tests/test_data/large
        key: large-files-${{ hashFiles('tests/test_data/large/checksums.json') }}
        enableCrossOsArchive: true
